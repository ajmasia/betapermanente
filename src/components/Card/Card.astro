---
import type { CollectionEntry } from "astro:content";
import CalendarIcon from "../icons/CalendarIcon.astro";
import ClockIcon from "../icons/ClockIcon.astro";
import Tag from "../Tag.astro";
import { calculateReadingTime, formatReadingTime } from "../../lib/readingTime.ts";

type BlogPost = CollectionEntry<"blog">;

interface Props {
  post: BlogPost;
  variant?: "vertical" | "horizontal";
  showImage?: boolean;
  linkTags?: boolean;
  headingLevel?: "h2" | "h3";
  class?: string;
}

const {
  post,
  variant = "vertical",
  showImage = true,
  linkTags = true,
  headingLevel = "h2",
  class: className = "",
} = Astro.props;

const isHorizontal = variant === "horizontal";
const HeadingTag = headingLevel;
---

<article
  class:list={[
    "card relative rounded-2xl bg-slate-50 dark:bg-slate-800 overflow-hidden transition-all duration-300 hover:shadow-lg",
    {
      "xl:max-h-[210px] xl:flex xl:flex-row": isHorizontal,
    },
    className,
  ]}
>
  {showImage && post.data.heroImage && (
    <>
      {/* Vertical image (always shown in vertical, hidden on xl in horizontal) */}
      <div class:list={[{ "xl:hidden": isHorizontal }]}>
        <img
          src={post.data.heroImage}
          alt={post.data.title}
          class="w-full h-auto"
        />
      </div>
      {/* Horizontal image (only shown on xl in horizontal variant) */}
      {isHorizontal && (
        <div class="hidden xl:block flex-shrink-0">
          <img
            src={post.data.heroImage}
            alt={post.data.title}
            class="h-[210px] w-auto"
          />
        </div>
      )}
    </>
  )}

  <div class="p-6 flex-1 overflow-hidden">
    <HeadingTag
      class:list={[
        "font-semibold mb-2 text-slate-600 dark:text-slate-300",
        {
          "text-2xl": headingLevel === "h2",
          "text-xl lg:text-2xl": headingLevel === "h3",
        },
      ]}
    >
      <a href={`/blog/${post.slug}`} class="card-link">
        {post.data.title}
      </a>
    </HeadingTag>

    <p
      class:list={[
        "mb-2",
        {
          "line-clamp-2 min-h-[3rem]": isHorizontal,
        },
      ]}
    >
      {post.data.description || ""}
    </p>

    <p class="flex text-slate-500 dark:text-slate-400 text-sm items-center mb-2">
      <span class="inline-flex items-center gap-1">
        <CalendarIcon class="h-4 w-4 flex-shrink-0" />
        <span>
          {post.data.date.toLocaleDateString("es-ES", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })}
        </span>
      </span>
      <span class="mx-2">Â·</span>
      <span class="inline-flex items-center gap-1">
        <ClockIcon class="h-4 w-4 flex-shrink-0" />
        <span>{formatReadingTime(calculateReadingTime(post.body))}</span>
      </span>
    </p>

    {post.data.tags && post.data.tags.length > 0 && (
      <div class="card-tags flex flex-wrap gap-2">
        {post.data.tags.map((tag: string) => (
          <Tag tag={tag} linked={linkTags} />
        ))}
      </div>
    )}
  </div>
</article>

<style>
  @reference "../../styles/global.css";

  /* Stretched link pattern */
  .card-link {
    @apply text-slate-600 dark:text-slate-300 no-underline transition-colors duration-300;
  }

  .card-link::after {
    content: "";
    position: absolute;
    inset: 0;
  }

  .card:hover .card-link {
    @apply text-red-400;
  }

  /* Tags stay clickable above the stretched link */
  .card-tags {
    position: relative;
    z-index: 1;
  }
</style>
