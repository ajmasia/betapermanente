---
import type { CollectionEntry } from "astro:content";
import CalendarIcon from "./icons/CalendarIcon.astro";
import ClockIcon from "./icons/ClockIcon.astro";
import RightArrow from "./icons/RightArrow.astro";
import Tag from "./Tag.astro";
import { calculateReadingTime, formatReadingTime } from "../lib/readingTime.ts";

type BlogPost = CollectionEntry<"blog">;

interface Props {
  latestPosts: BlogPost[];
  showImages?: boolean;
}

const { latestPosts, showImages = true } = Astro.props;
---

<section class="container mx-auto mt-20">
  <div class="text-center mb-8">
    <h2>Últimas Publicaciones</h2>
    <a href="/blog" class="link text-sm inline-flex items-center gap-1">
      Ver todas
      <RightArrow class="w-3 h-3" />
    </a>
  </div>

  <div
    class:list={[
      "grid gap-8",
      {
        "grid-cols-1": latestPosts.length === 1,
        "grid-cols-1 lg:grid-cols-2": latestPosts.length === 2,
        "grid-cols-1 lg:grid-cols-2 xl:grid-cols-3": latestPosts.length >= 3,
      },
    ]}
  >
    {
      latestPosts.map((post, index) => (
        <a
          href={`/blog/${post.slug}`}
          class:list={[
            "block rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 overflow-hidden transition-all duration-300 hover:border-slate-300 dark:hover:border-slate-600 hover:shadow-lg",
            {
              "lg:hidden xl:block": index === 2 && latestPosts.length === 3,
            },
            {
              "xl:hidden": index === 3 && latestPosts.length >= 4,
            },
          ]}
        >
          {showImages && post.data.heroImage && (
            <img
              src={post.data.heroImage}
              alt={post.data.title}
              class="w-full h-48 object-cover"
            />
          )}
          <div class="p-6">
          <h3 class="text-2xl font-semibold mb-2 text-slate-600 dark:text-slate-300">
            {post.data.title}
          </h3>
          {post.data.description && <p class="mb-2">{post.data.description}</p>}
          <p class="flex text-slate-500 dark:text-slate-400 text-sm items-center mb-2">
            <span class="inline-flex items-center gap-1">
              <CalendarIcon class="h-4 w-4 flex-shrink-0" />
              <span class="">
                {post.data.date.toLocaleDateString("es-ES", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </span>
            </span>
            <span class="mx-2">·</span>
            <span class="inline-flex items-center gap-1">
              <ClockIcon class="h-4 w-4 flex-shrink-0" />
              <span>{formatReadingTime(calculateReadingTime(post.body))}</span>
            </span>
          </p>
          {post.data.tags && post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {post.data.tags.map((tag: string) => (
                <Tag tag={tag} linked={false} />
              ))}
            </div>
          )}
          </div>
        </a>
      ))
    }
  </div>
</section>
