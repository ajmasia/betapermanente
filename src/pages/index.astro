---
import { getPageTitle } from "../lib/navigation.ts";

import MainLayout from "../layouts/MainLayout/MainLayout.astro";
import Hero from "../components/Hero.astro";
import LatestPosts from "../components/LatestPosts.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { SITE } from "../config.ts";

type BlogPost = CollectionEntry<"blog">;

// Get latest 4 posts
const posts: BlogPost[] = await getCollection(
  "blog",
  ({ data }: BlogPost) => data.draft !== true && data.lang == "es",
);

// Sort posts by date (most recent first) and take only 4
posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const latestPosts = posts.slice(0, 4);
---

<MainLayout title={getPageTitle(Astro.url.pathname)}>
  <Hero />
  <LatestPosts
    latestPosts={latestPosts}
    showImages={SITE.showLatestPostsImages}
  />
</MainLayout>
